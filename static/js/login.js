function showAlert(e,t){const o=document.getElementById("alertBox");o.textContent=e,o.className=`alert alert-${t} show`,setTimeout(()=>{o.classList.remove("show")},3e3)}document.getElementById("loginForm").addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("username").value.trim(),o=document.getElementById("password").value,n=document.getElementById("loginBtn");document.getElementById("alertBox");if(t&&o){n.disabled=!0,n.innerHTML='<span class="loading-spinner"></span>登录中...';try{const e=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:o})}),r=await e.json();e.ok?(localStorage.setItem("authToken",r.token),localStorage.setItem("username",r.username),localStorage.setItem("userRole",r.role),showAlert("登录成功！正在跳转...","success"),setTimeout(()=>{window.location.href="/admin"},500)):(showAlert(r.error||"登录失败，请检查用户名和密码","error"),n.disabled=!1,n.innerHTML="登录")}catch(e){console.error("Login error:",e),showAlert("网络错误，请稍后重试","error"),n.disabled=!1,n.innerHTML="登录"}}else showAlert("请填写用户名和密码","error")}),window.addEventListener("DOMContentLoaded",()=>{const e=localStorage.getItem("authToken");e&&fetch("/api/auth/verify",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}).then(e=>{e.ok&&(window.location.href="/admin")}).catch(e=>{console.error("Token verification error:",e)})}),document.getElementById("password").addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),document.getElementById("loginForm").dispatchEvent(new Event("submit")))});